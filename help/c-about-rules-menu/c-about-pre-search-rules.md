---
description: 検索前のルールを使用して、着信クエリを分析し、使用するプレゼンテーションテンプレートを決定します。 検索前のルールは、各クエリに対して順に実行されます。 ルールの順序を変更するには、ドラッグ&ドロップを使用します。 実際の注文は、保存するまで変更されません。
solution: Target
title: 検索前のルールについて
topic-legacy: Rules,Site search and merchandising
uuid: e75f9d9e-e8ca-4184-bf79-b1fdadb5c0fe
exl-id: 23e7feda-956a-48ce-8c61-fe0498c1bbda
translation-type: tm+mt
source-git-commit: 7559f5f7437d46e3510d4659772308666425ec96
workflow-type: tm+mt
source-wordcount: '1661'
ht-degree: 1%

---

# 検索前のルールについて{#about-pre-search-rules}

検索前のルールを使用して、着信クエリを分析し、使用するプレゼンテーションテンプレートを決定します。 検索前のルールは、各クエリに対して順に実行されます。 ルールの順序を変更するには、ドラッグ&amp;ドロップを使用します。 実際の注文は、保存するまで変更されません。

## 検索前のルールの使用{#concept_5BF84BB6FACB4645BA9CB7496A01CD1F}

検索前のルールは、通常、受信したクエリに基づいて結果を表示するプレゼンテーションテンプレートを選択するために使用します。 より高度な機能を使用して、プレゼンテーションテンプレートの検索に使用するクエリを変更できます。 必要に応じて、クエリパラメーターの値を追加、削除、または変更できます。 検索前処理クエリは、入力されるたびに、検索前のルールを調べて、クエリが変更されているか、どのプレゼンテーションテンプレートが使用されているかを判断します。 各検索前のルールは、2つの主要な要素で構成されます。ルールのアクションとオプションの条件。 ルールと条件の数に制限はありません。 ルールセットはルールごとにループされるので、これらのルールの順序は重要です。 ルールの条件が一致すると、関連付けられたすべてのアクションが実行されます。

検索前の処理モジュールでは、定義済みのすべてのテンプレートと、それに関連する名前付き検索がインスタンス化されます。各検索には、cgiパラメーターのローカルコピーが与えられます。 その結果、テンプレートで使用されている別の名前付き検索を変更したり、他のテンプレートのいずれかに影響を与えたりすることなく、検索で使用されるcgiパラメータの1つを追加、削除、または変更して、検索をカスタマイズできます。 その結果、複数の結果セットを表示するプレゼンテーションテンプレートがある場合は、各検索を個別にカスタマイズできます。 グローバルCGIパラメーターを各テンプレートの各検索にコピーする前に、グローバルCGIパラメーターに対して変更を行う場合は、クエリクリーニングモジュールを使用します。

## 検索前のルールの条件{#section_B5568ADEB28546A280720309498B045D}

条件はオプションです。 すべてのクエリに対してアクションを指定するように選択した場合、アクションは常に実行されます。 最初のルールは、デフォルトのプレゼンテーションテンプレートを選択するすべてのクエリに対して実行するのがベストプラクティスです。 これにより、どのクエリが入ってくるかに関係なく、使用するシナリオプレゼンテーションテンプレートが最も悪い場合に選択されていることを確認できます。 条件は、前のルールで設定された任意のCGIクエリパラメーター、cookie、またはカスタム変数に基づくことができます。

## 検索前のルールのアクション{#section_3B8E19D287554C1C969F5B8D81226981}

一致する条件を持つ事前検索ルール内のすべてのアクションが実行されます。 通常、アクションは、操作、操作を実行するデータ、および使用する値で構成されます。 最も簡単な操作は、クエリが検索前のルールの条件に一致する場合に、どのプレゼンテーションテンプレートを使用するかを指定することです。 次に、対象のテンプレートをプレゼンテーションテンプレートの名前に設定します。 テンプレートの検索パラメーターに対して操作を実行することで、特定のテンプレートで使用される検索を変更する場合は、より複雑なアクションを使用できます。 テンプレートの検索パラメータに対して操作を実行する場合は、プレゼンテーションテンプレートと検索を指定します。

## 一般的なルール{#section_885ECB9DBF0C4D539C14F82BCAA35B4E}

テンプレートの検索パラメーターに対して操作を実行する場合、次の2つの特別な値が存在します。*プレゼンテーションテンプレートのターゲットを指定し、*プライマリを指定した検索。 これらの値を使用して、現在のターゲットテンプレートのプライマリ検索に基づいたルールを作成できます。 これらの構成により、現在のターゲットテンプレートやプライマリ検索が呼び出される内容を気にする必要がない、汎用ルールを作成できます。 明らかに、以前の検索前のルールは、現在のターゲットテンプレートが何であるかを定義しています。 選択しない場合は、最初のプレゼンテーションテンプレートが自動的に選択され、意図しない結果が生成されます。

## 例 {#section_EA153A151987454EA44A4A6862466DF6}

デフォルトのテンプレートをguided.tmplに設定します。ユーザーがlangというcgiパラメーターを渡したときに、既知の言語に設定した場合は、その言語のテンプレートを使用します。

```
    On condition: 
      Every Query 
    Perform the following actions: 
      Set targeted template to guided 
 
    On condition: 
      Query lang matches regular expression fr 
    Perform the following actions: 
      Set targeted template to guided_french 
 
    On condition: 
      Query lang matches regular expression de 
    Perform the following actions: 
      Set targeted template to guided_german
```

## ベストプラクティス {#section_31EBAE5E54174DEE8986CBB636746A98}

* 最初のルールでは、すべてのクエリのデフォルトテンプレートが選択されます。
* クエリのデータマイニングは、クエリクリーニングルール内で行われます。 これらは、検索前の処理で参照できます。
* 検索前ルールで導入した新し追加いカスタム変数は、すべてのクエリに対して実行され、他の検索前ルールが参照する前に、それらの変数に対して実行されます。

## 新しい検索前の規則の追加{#task_182B95918462490D8BDA7F16A81CAC11}

[!DNL Pre-Search Rules]を使用して、入力クエリに基づいて検索結果を表示する際に使用するプレゼンテーションテンプレートを選択できます。

**新しい検索前のルールを追加するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Pre-Search Rules]**&#x200B;をクリックします。
1. [!DNL Pre-Search Rules]ページで、**[!UICONTROL Add New Rule]**&#x200B;をクリックします。
1. [!DNL Name]フィールドに、新しいクエリクリーニング規則の名前を入力します。
1. [!DNL Add Pre-Search Rule]ページで、ドロップダウンリストとテキストフィールドを使用してクエリを作成します。

   <table> 
    <thead> 
      <tr> 
      <th colname="col1" class="entry"> <p>オプション </p> </th> 
      <th colname="col2" class="entry"> <p>説明 </p> </th> 
      </tr> 
    </thead>
    <tbody> 
      <tr> 
      <td colname="col1"> <p>Cookie </p> </td> 
      <td colname="col2"> <p>HTTP cookie。 Cookieの名前と値は、Uniform Resource Identifierをエンコードする必要があります。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>カスタム変数 </p> </td> 
      <td colname="col2"> <p>ユーザー定義の変数。 追加ユーザー定義変数の数に制限はありません。 </p> <p>プリ検索ルール内のクエリクリーニングモジュールで定義した変数はどれでも参照できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>システム変数 </p> </td> 
      <td colname="col2"> <p>チェックできる内部システムによって設定された読み取り専用の変数。 次のシステム変数がサポートされています。 </p> <p> 
        <ul id="ul_BC17F1637F27424CA4E8F530C28A3245"> 
          <li id="li_C7DF96EFD7AA4A449D00F7EACCAA0EB1"> <span class="uicontrol"> hostname </span> <p>サーバーホストの名前。 </p> </li> 
          <li id="li_F85AB1D2B9374A859657D12B8ED6674B"> <span class="uicontrol"> uri </span> <p>クエリ文字列を含まない、要求されたURI。 </p> </li> 
          <li id="li_440149C9EC6E4805B77BBC97BE41542A"> <span class="uicontrol"> args  </span> <p>クエリ文字列全体。 </p> </li> 
          <li id="li_F583FC4B0E404858BB3522B33A6F7A0A"> <span class="uicontrol"> 環境 </span> <p>"ステージ"または"ライブ"。どちらを指定するかは、着信クエリがステージング環境に送信されたか、ライブに送信されたかによって異なります。 </p> </li> 
          <li id="li_15902AA49B144D42A5E95D7E8B0FB1E1"> <span class="uicontrol"> referrer </span> <p>顧客の送信元のURL。 </p> </li> 
        </ul> </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ファセット </p> </td> 
      <td colname="col2"> <p>特定のファセットに関連付けられているグローバルコレクション内の特別なCGIパラメーター。 すべてのCGIパラメーターは、クエリのクリーニング後に、テンプレート内の各名前付き検索にコピーされます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>クエリパラメーター </p> </td> 
      <td colname="col2"> <p>グローバルコレクションのCGIパラメーター。 これらのパラメーターは、クエリクリーニングの後、テンプレート内の各名前付き検索にコピーされます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートの検索パラメーター </p> </td> 
      <td colname="col2"> <p>プレゼンテーションテンプレートに関連付けられた名前付き検索に対してローカルなCGIパラメーター。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートのバックエンドパラメーター </p> </td> 
      <td colname="col2"> <p>着信クエリのパラメーターは、最終的に、検索の実行に使用されるバックエンドパラメーターに変換されます。 </p> <p><a href="../c-appendices/c-cgiparameters.md#reference_582E85C3886740C98FE88CA9DF7918E8" type="reference" format="dita" scope="local">バックエンド検索CGIパラメーター</a>を参照してください。 </p> <p>バックエンドパラメーターは、ナビゲーション要素に表示されません。 その結果、顧客から検索に適用する追加のパラメーターを非表示にできます。 このパラメータは、プレゼンテーションテンプレート内の特定の検索に対してローカルです。 バックエンドパラメーターに対するアクションは遅延バインディングです。つまり、検索が送信される直前に適用されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ターゲットテンプレート </p> </td> 
      <td colname="col2"> <p>削除できないシステム定義のカスタム変数の特殊なインスタンス。 この変数には、現在のターゲットプレゼンテーションテンプレートが含まれます。 この変数は、カスタム変数「targeted_template」を指定することで読み取りまたは設定できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ランク </p> </td> 
      <td colname="col2"> <p>検索に使用するランキングルールを指定できます。 このオプションは、ランキングフィールドとランキングルールを定義した場合にのみ表示されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>格納 </p> </td> 
      <td colname="col2"> <p>検索エンジンは、ホスト名または<span class="codeph"> gs_store </span>クエリパラメーターに基づいて顧客がどのストアにいるかを自動的に検出し、後者の方が優先されます。 店の条件を作ることができます。 クエリクリーニングのみでは、現在のストアを上書きするアクションも使用できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>最後のルール </p> </td> 
      <td colname="col2"> <p>オンの場合、検索前処理モジュールは、一致ルールのアクションの後に追加のルールを実行しません。 このアクションは、後のルールが一致するように設定したが、後のルールを実行したくないアクションがある場合に便利です。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>停止 </p> </td> 
      <td colname="col2"> <p>ルールの実行をオフにしますが、ルールは削除されません。 </p> </td> 
      </tr> 
    </tbody> 
    </table>

1. クリック **[!UICONTROL Add]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索前の規則の編集{#task_25F77050C5DA42B29DFD1C9718FB8C64}

[!DNL Pre-Search Rules]ページに追加した既存の検索前のルールを編集できます。

**検索前のルールを編集するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Pre-Search Rules]**&#x200B;をクリックします。
1. [!DNL Pre-Search Rules]ページのテーブルの&#x200B;**[!UICONTROL Actions]**&#x200B;列の下で、編集する関連ルールの&#x200B;**[!UICONTROL Edit]**&#x200B;をクリックします。
1. [!DNL Edit Pre-Search Rule]ページで、ドロップダウンリストとテキストフィールドを使用してクエリを作成します。

   「[新しい検索前のルールの追加](../c-about-rules-menu/c-about-pre-search-rules.md#task_182B95918462490D8BDA7F16A81CAC11)」のオプションの表を参照してください。
1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索前の規則の削除{#task_128B6A79CA6C451C991AEDAD58F51743}

不要になった、または使用しなくなった検索前のルールは削除できます。

ルールを削除すると、残りのルールが実行される順序が、削除を考慮して自動的に調整されます。

**検索前のルールを削除するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Pre-Search Rules]**&#x200B;をクリックします。
1. [!DNL Pre-Search Rules]ページのテーブルの&#x200B;**[!UICONTROL Actions]**&#x200B;列の下で、削除する関連ルールの&#x200B;**[!UICONTROL Delete]**&#x200B;をクリックします。
1. [!DNL Confirmation]ダイアログボックスで、**[!UICONTROL OK]**&#x200B;をクリックします。
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索前のルールで{#task_C18817276A3C459089C97448076365D1}を実行する順序の変更

プレゼンテーションテンプレートで実行する順序を変更するには、検索前のルールの順序を変更します。

検索前のルールは、定義された順に実行されます。 ルールの順序番号が高いほど、プロセス内で後で実行され、以前のルールが切り捨てられます。 ルールの順序を変更するには、[!DNL Pre-Search Rules]ページのテーブルの順序列に新しい番号を入力します。 ルールのドラッグ&amp;ドロップを使用して、ルールの実行順序を変更することもできます。

**検索前ルールの実行順序を変更するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Pre-Search Rules]**&#x200B;をクリックします。
1. [!DNL Pre-Search Rules]ページで、次のいずれかの操作を行います。

   * **[!UICONTROL Order]**&#x200B;列ヘッダーをクリックして、ルールを昇順または降順に並べ替えます。
   * **[!UICONTROL Order]**&#x200B;列の検索前のルール名の左側にあるテキストフィールドに、ルールを実行する順序番号を入力します。
   * ルールを実行する位置にテーブル行をドラッグ&amp;ドロップします。 ルールが実行される新しい順序を反映するために、すべての注文番号が更新されます。

1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。
