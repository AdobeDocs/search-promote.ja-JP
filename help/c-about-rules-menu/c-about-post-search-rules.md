---
description: 検索後のルールを使用して、検索結果を調べ、検索が表示コンテンツに与える影響を判断できます。
seo-description: 検索後のルールを使用して、検索結果を調べ、検索が表示コンテンツに与える影響を判断できます。
seo-title: 検索後のルールについて
solution: Target
title: 検索後のルールについて
topic: Rules,Site search and merchandising
uuid: 312d1e4a-f5b6-4629-8645-17e6f6c09fc4
translation-type: tm+mt
source-git-commit: d07cdc2c88f93eed4cecb0ee8818f7fdea06ee9d

---


# 検索後のルールについて{#about-post-search-rules}

検索後のルールを使用して、検索結果を調べ、検索が表示コンテンツに与える影響を判断できます。

## 検索後ルールの使用 {#concept_AF6ADFCC0ADF4A788003964939917FDE}

検索結果がない場合、検索後ルールで類似の項目の検索を実行できます。 または、見つからなかった品目を検索する顧客に他の品目をレコメンドするWebページを表示できます。

各検索後ルールは、2つの主要な要素で構成されます。ルールのアクションと、そのオプションの条件。 ルールと条件の数に制限はありません。 ルールセットはルールごとにループされるので、ルールの順序は重要です。 ルールの条件が一致すると、関連付けられたすべてのアクションが実行されます。

検索結果のセットを絞り込んで、最大3ラウンドの検索結果を得ることができます。 その後、現在使用可能なものが使用されます。 この制限により、無限ループを防ぎ、顧客が効率的な応答を受け取るようにします。 検索をやり直す回数が多いほど、検索結果が返されるまでにかかる時間が長くなります。 一致ルールがいずれも現在使用されているプレゼンテーションテンプレートの検索を変更しない場合、またはテンプレートを切り替えた場合、検索結果のセットは確定済みと見なされ、検索後に終了します。

検索後の処理は、以前の処理モジュールのクエリクリーニングと検索前の処理に基づいて行われます。 したがって、これらのモジュールに設定されたカスタム変数は、検索後の処理ルールで使用できます。 同様に、プレサーチ処理では、プレゼンテーションテンプレートに関連付けられた名前付きの各検索にCGIパラメータのローカルコピーが割り当てられている、すべてのテンプレートがインスタンス化されています。 また、各検索を個別にカスタマイズできます。

「クエリク [リーニングルールについて](../c-about-rules-menu/c-about-query-cleaning-rules.md#concept_17F3CDDC3C8A4128AF092A82B777B86C)」を参照。

See [About Pre-Search Rules](../c-about-rules-menu/c-about-pre-search-rules.md#concept_5BF84BB6FACB4645BA9CB7496A01CD1F).

## 検索後ルールの条件について {#section_C43EB77CC0AC43B8B9D38569264BF1B5}

条件はオプションです。 すべてのクエリに対してアクションを指定するように指定した場合、アクションは常に実行されます。 条件は、以前のルールで設定したCGIクエリパラメーター、cookie、検索結果、またはカスタム変数に基づいて設定できます。 また、現在選択されているテンプレートが何であるかや、最後の検索であるかなどのシステム条件に基づいてテンプレートを作成することもできます。 検索またはCGIパラメーターの結果に条件を作成する場合は、テンプレートと検索の名前を指定します。

## 検索後ルールのアクションについて {#section_0E15FE683A894ECAAA386267EEC7F7C5}

一致する条件を持つ検索後ルール内のすべてのアクションが実行されます。 通常、アクションは、操作、操作を実行するデータ、および使用する値で構成されます。 最も簡単なアクションは、検索後のルールの条件に基づいて、使用するプレゼンテーションテンプレートを切り替えることです。 より高度なアクションを使用して、検索をやり直す検索のパラメータを変更できます。 テンプレートの検索パラメータに対して操作を実行する場合は、プレゼンテーションテンプレートと検索を指定します。

## 一般規則 {#section_AEE923988CC748FF9DEF2233FBF333B5}

テンプレートの検索パラメータに対して操作を実行する場合、プレゼンテーションテンプレートと名前付き検索のそれぞれに*targetedと*primaryの2つの特別な値が存在します。 これらの値を使用して、現在のターゲットテンプレートのプライマリ検索に基づいてルールを作成します。 これらの構成を使用すると、現在のターゲットテンプレートやプライマリ検索が何と呼ばれているかを気にする必要がない、一般的なルールを作成できます。 このパスが検索後処理の最初のパスである場合、対象となるテンプレートは、検索前処理で設定されたテンプレートです。

## リダイレクト {#section_E5669A2F13C240F2968E31C75591CD6A}

クエリクリーニング内での直接ヒットおよびリダイレクトを使用すると、入力された検索用語に基づいてURLにリダイレクトできます。 検索後のルール内でリダイレクトを行うと、このアイデアが拡張されます。ただし、リダイレクトを行うかどうかを判断する前に、検索が返した結果の数を確認できます。 検索後のルールを使用すると、URLにリダイレクトして、カスタム変数やクエリパラメーターを置き換えることができます。 または、最初の結果内のフィールドにリダイレクトできます。 結果のフィールドにリダイレクトする場合は、トランスポートテンプレートでフィールドを定義し、有効な明示的なURLを含める必要があります。それ以外の場合、リダイレクトはスキップされます。

検索後ルール内でリダイレクトメカニズムを使用すると、検索が単一の結果を返すタイミングを検出できます。 このような結果を返す代わりに、結果に関連付けられたWebページにリダイレクトできます。

検索後のルールでリダイレクトを使用する例については、以下のリダイレクトの例を参照してください。

## 最後のルール {#section_FC1E0050C9324278B171038E98F6C335}

オプションが設定されたルールの条件が満たされた場合、 **[!UICONTROL Last Rule]** 検索後処理モジュールは、一致ルールのアクションの後に追加のルールを実行しません。 この状況は、後のルールが一致するアクションを設定し、処理を停止する場合に役立ちます。 そして、その後のルールが、次の検索の後に一致する可能性を持つように。

## 例 {#section_DDB98383690941F9B44AD00FBA55BB56}

次の例では、2つのプレゼンテーションテンプレートがあるとします。 1つのテンプレートは多数の検索結果を表示するのに使用され、もう1つのテンプレートは1つの結果を表示するのに使用され、もう1つのテンプレートはメイン検索に関連するアクセサリを追加検索するのに使用されます。 結果が1つあるかどうかを検出し、他のプレゼンテーションテンプレートに切り替える場合。 このタスクを実行するには、次のルールを使用します。

```
On condition: 
  targeted template is default 
  targeted template primary results equal 1 
  not last search 
Perform the following actions: 
  Set targeted template to product_spotlight
```

MegaElectronicは大規模なエレクトロニクスストアです。 MegaElectronicは、検索データを分析した後、多くの顧客が製品の部品番号を使用して製品検索を実行したことに気づきます。 この場合、顧客が直接検索した製品が1つしか見つからない場合、MegaElectronicは製品に関連付けられたWebページにリダイレクトしたいと考えています。

この結果を得るには、1つのルールを3つの条件で使用します。 最初の条件は、返された検索結果が1つだけであるかどうかを確認します。 2つ目の条件は、クエリ用語がMegaElectronicの部品番号形式と一致し、リダイレクトの原因となる結果を示します。 3つ目の条件では、部品番号が部品番号の一部で、複数の結果が返される場合があるので、顧客が1つの結果にドリルダウンするためにファセットを使用しないようにします。 アクションは結果内のフィールドにリダイレクトされます。

```
On condition: 
  targeted template's primary results equal 1 
  query q matches regular expression ^\D\D\D-\d+ 
  no facet selected ^\D\D\D-\d+ 
Perform the following actions: 
  redirect to result field "loc" in template *targeted for search *primary
```

## ベストプラクティス {#section_1BF7DE1BD5664B3BAEC26AA829FDB0BA}

* 新しい一連の検索をトリガーする一連のルールには、常に条件節を含め、これがモジュールの最後のパスでないことを確認する必要があります。 検索回数の上限を既に実行している場合は、検索をやり直すことはできません。
* モジュールを最後に通過した後も結果が不十分な場合は、「結果なし」のテンプレートに切り替えることができます。
* プレゼンテーションテンプレートは、他のパラメーターを含む可能性のある検索の結果に基づいて変更する必要があります。 入力クエリのみに基づくテンプレートを選択する場合は、検索前のルールの方が効率的です。
* クエリのデータマイニングは、クエリクリーニングモジュールで行います。 カスタム変数は、検索後の処理で参照できます。
* リダイレクトを行う場合は、常に顧客がファセットを選択していないことを確認します。 その理由は、顧客がファセットをドリルダウンし、検索結果から突然取り除かれた場合に不便であるためです。 顧客は、単一の結果を求めていないと判断した場合に、ファセットの選択を解除することができます。

## 新しい検索後ルールの追加 {#task_52F6F9AAD65B45B5ACA1FF245DFFADD9}

を使用して、入力ク [!DNL Post-Search Rules] エリに基づいて検索結果を表示するために使用するプレゼンテーションテンプレートを選択できます。

**新しい検索後ルールを追加するには**

1. 製品メニューで、/をクリッ **[!UICONTROL Rules]** クしま **[!UICONTROL Post-Search Rules]**&#x200B;す。
1. ページ上で、 [!DNL Post-Search Rules] をクリックしま **[!UICONTROL Add New Rule]**&#x200B;す。
1. 新しいク [!DNL Name] エリ消去ルールの名前をフィールドに入力します。
1. ページ上 [!DNL Add Post-Search Rule] で、コンボボックスとテキストフィールドを使用してクエリを作成します。

   <table> 
    <thead> 
      <tr> 
      <th colname="col1" class="entry"> <p>オプション </p> </th> 
      <th colname="col2" class="entry"> <p>説明 </p> </th> 
      </tr> 
    </thead>
    <tbody> 
      <tr> 
      <td colname="col1"> <p>Cookie </p> </td> 
      <td colname="col2"> <p>HTTP cookie。 Cookieの名前と値は、Uniform Resource Identifierエンコードする必要があります。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>カスタム変数 </p> </td> 
      <td colname="col2"> <p>ユーザー定義の変数。 カスタム変数の追加、削除、設定は無制限です。 </p> <p>検索後ルール内の「クエリのクリーニング」および「検索前のルール」モジュールで定義したカスタム変数を参照できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>システム変数 </p> </td> 
      <td colname="col2"> <p>チェック可能な内部システムによって設定された読み取り専用変数。 次のシステム変数がサポートされています。 </p> <p> 
        <ul id="ul_BC17F1637F27424CA4E8F530C28A3245"> 
          <li id="li_C7DF96EFD7AA4A449D00F7EACCAA0EB1"> <span class="uicontrol"> hostname </span> <p>サーバーホストの名前。 </p> </li> 
          <li id="li_F85AB1D2B9374A859657D12B8ED6674B"> <span class="uicontrol"> uri </span> <p>クエリ文字列を含まない、要求されたUniform Resource Identifier。 </p> </li> 
          <li id="li_440149C9EC6E4805B77BBC97BE41542A"> <span class="uicontrol"> args </span> <p>クエリ文字列全体。 </p> </li> 
          <li id="li_F583FC4B0E404858BB3522B33A6F7A0A"> <span class="uicontrol"> 環境 </span> <p>受信クエリがステージ環境に送信されたか、実稼働環境に送信されたかに応じて、「ステージ」または「ライブ」。 </p> </li> 
          <li id="li_15902AA49B144D42A5E95D7E8B0FB1E1"> <span class="uicontrol"> referrer </span> <p>顧客が属するURL(Uniform Resource Locator)。 </p> </li> 
        </ul> </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>システム変数 </p> </td> 
      <td colname="col2"> <p>読み取り専用の変数で、現在の状態を判断する際に条件で使用できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートの検索ファセット </p> </td> 
      <td colname="col2"> <p>プレゼンテーションテンプレートに関連付けられた名前付き検索に対してローカルなファセット。 ファセットは、基本的に、顧客が選択したファセット内の値を示すために使用される特別なCGIパラメータです。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートの検索パラメータ </p> </td> 
      <td colname="col2"> <p>プレゼンテーションテンプレートに関連付けられた名前付き検索に対してローカルなCGIパラメーター。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートのバックエンドパラメータ </p> </td> 
      <td colname="col2"> <p>着信クエリパラメーターは、最終的に、検索の実行に使用されるバックエンドパラメーターに変換されます。 </p> <p>バックエンド <a href="../c-appendices/c-cgiparameters.md#reference_582E85C3886740C98FE88CA9DF7918E8" type="reference" format="dita" scope="local"> 検索のCGIパラメーターを参照してくだ </a>さい。 </p> <p>バックエンドパラメーターは、ナビゲーション要素に表示されません。 その結果、検索に適用する追加のパラメーターを顧客から非表示にすることができます。 </p> <p>パラメータは、プレゼンテーションテンプレート内の特定の検索に対してローカルです。 バックエンドパラメーターに対するアクションは遅延バインディングです。つまり、検索が送信される直前に適用されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ターゲットテンプレート </p> </td> 
      <td colname="col2"> <p>削除できないシステム定義のカスタム変数の特殊なインスタンス。 この変数には、現在のターゲットプレゼンテーションテンプレートが含まれます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ランク </p> </td> 
      <td colname="col2"> <p>検索に使用するランキングルールを指定できます。 このオプションは、ランキングフィールドとランキングルールを定義した場合にのみ表示されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>最後のルール </p> </td> 
      <td colname="col2"> <p>チェックすると、検索後の処理モジュールは、一致ルールのアクションの後に追加のルールを実行しません。 このアクションは、後のルールが一致するが、後のルールを実行したくないアクションを設定した場合に便利です。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>停止 </p> </td> 
      <td colname="col2"> <p>ルールの実行をオフにしますが、ルールは削除しません。 </p> </td> 
      </tr> 
    </tbody> 
    </table>

1. クリック **[!UICONTROL Add]**.
1. （オプション）次のいずれかの操作を行います。

   * 変更を **[!UICONTROL History]** 元に戻すには、をクリックします。

      詳しくは、「 [履歴」オプションの使用を参照してくださ](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)い。

   * クリック **[!UICONTROL Live]**.

      ライブ設 [定の表示を参照してください](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)。

   * クリック **[!UICONTROL Push Live]**.

      詳しくは、ス [テージ設定をライブにプッシュするを参照してくださ](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)い。

## 検索後ルールの編集 {#task_ECB00334C0A74C87AF857DB3EB372119}

ページに追加した既存の検索後ルールを編集でき [!DNL Post-Search Rules] ます。

**検索後のルールを編集するには**

1. 製品メニューで、/をクリッ **[!UICONTROL Rules]** クしま **[!UICONTROL Pre-Search Rules]**&#x200B;す。
1. ページ [!DNL Post-Search Rules] の表の列の下 **[!UICONTROL Actions]** で、編集する関連 **[!UICONTROL Edit]** 付けられたルールをクリックします。
1. ページ上 [!DNL Edit Post-Search Rule] で、コンボボックスとテキストフィールドを使用してクエリを作成します。

   「新しい検索後ルールの追加」の [オプションの表を参照してください](../c-about-rules-menu/c-about-post-search-rules.md#task_52F6F9AAD65B45B5ACA1FF245DFFADD9)。
1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * 変更を **[!UICONTROL History]** 元に戻すには、をクリックします。

      詳しくは、「 [履歴」オプションの使用を参照してくださ](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)い。

   * クリック **[!UICONTROL Live]**.

      ライブ設 [定の表示を参照してください](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)。

   * クリック **[!UICONTROL Push Live]**.

      詳しくは、ス [テージ設定をライブにプッシュするを参照してくださ](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)い。

## 検索後ルールの削除 {#task_0F4653AB20D54B769A4FA8D1491AB4CF}

不要になった検索後のルールや、使用しなくなった検索後のルールは削除できます。

ルールを削除すると、残りのルールが実行される順序が、削除に合わせて自動的に調整されます。

**検索後のルールを削除するには**

1. 製品メニューで、/をクリッ **[!UICONTROL Rules]** クしま **[!UICONTROL Post-Search Rules]**&#x200B;す。
1. ページ [!DNL Post-Search Rules] の表の列の下 **[!UICONTROL Actions]** で、削除する関連 **[!UICONTROL Delete]** 付けられたルールをクリックします。
1. ダイアログボッ [!DNL Confirmation] クスで、をクリックしま **[!UICONTROL OK]**&#x200B;す。
1. （オプション）次のいずれかの操作を行います。

   * 変更を **[!UICONTROL History]** 元に戻すには、をクリックします。

      詳しくは、「 [履歴」オプションの使用を参照してくださ](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)い。

   * クリック **[!UICONTROL Live]**.

      ライブ設 [定の表示を参照してください](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)。

   * クリック **[!UICONTROL Push Live]**.

      詳しくは、ス [テージ設定をライブにプッシュするを参照してくださ](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)い。

## 検索後ルールの実行順序の変更 {#task_40542FCD32234BBF881A81BF5477F78F}

検索後のルールの順序を変更して、プレゼンテーションテンプレートで実行する順序を変更できます。

検索後のルールは、定義された順序で実行されます。 ルールの順序番号が大きいほど、プロセスで後から実行され、以前のルールが切り捨てられます。 ルールの順序を変更するには、ページ上のテーブルの「順序」列に新しい番号を入力 [!DNL Post-Search Rules] します。 ルールのドラッグ&amp;ドロップを使用して、ルールの実行順序を変更することもできます。

**検索後ルールの実行順序を変更するには**

1. 製品メニューで、/をクリッ **[!UICONTROL Rules]** クしま **[!UICONTROL Post-Search Rules]**&#x200B;す。
1. ページで、 [!DNL Post-Search Rules] 次のいずれかの操作を行います。

   * Click the **[!UICONTROL Order]** column header to sort the rules in ascending or descending order.
   * 検索前 [!DNL Order] ルール名の左側にあるテキストフィールドの列に、ルールを実行する注文番号を入力します。
   * ルールを実行する位置にテーブル行をドラッグ&amp;ドロップします。 すべての注文番号が更新され、ルールが実行される新しい順序が反映されます。

1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * 変更を **[!UICONTROL History]** 元に戻すには、をクリックします。

      詳しくは、「 [履歴」オプションの使用を参照してくださ](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)い。

   * クリック **[!UICONTROL Live]**.

      ライブ設 [定の表示を参照してください](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)。

   * クリック **[!UICONTROL Push Live]**.

      詳しくは、ス [テージ設定をライブにプッシュするを参照してくださ](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)い。
