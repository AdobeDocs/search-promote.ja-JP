---
description: 検索後ルールを使用すると、検索結果を調べ、検索が表示コンテンツに与える影響を判断できます。
solution: Target
title: 検索後ルールについて
topic: ルール，サイト検索とマーチャンダイジング
uuid: 312d1e4a-f5b6-4629-8645-17e6f6c09fc4
translation-type: tm+mt
source-git-commit: d015154efdccbb4c6a39a56907c0c337ec065c9f
workflow-type: tm+mt
source-wordcount: '2102'
ht-degree: 1%

---


# 検索後のルールについて{#about-post-search-rules}

検索後ルールを使用すると、検索結果を調べ、検索が表示コンテンツに与える影響を判断できます。

## 検索後のルールの使用{#concept_AF6ADFCC0ADF4A788003964939917FDE}

検索結果が見つからない場合、検索後ルールは類似の項目を検索できます。 または、見つからなかった品目を検索する顧客に対して、他の品目をレコメンドするWebページを表示できます。

各検索後ルールは、2つの主要な要素で構成されます。ルールのアクションとオプションの条件。 ルールと条件の数に制限はありません。 ルールセットはルールごとにループされるので、これらのルールの順序は重要です。 ルールの条件が一致する場合は、関連するすべてのアクションが実行されます。

最大3ラウンドの検索で、検索結果のセットを絞り込むことができます。 その後、現在使用可能なものが使用されます。 この制限により、無限ループを防ぎ、顧客が効率的な応答を受け取るようにします。 検索をやり直す回数が多いほど、検索結果が返されるまでにかかる時間が長くなります。 一致ルールが現在使用しているプレゼンテーションテンプレートの検索の1つを変更しない場合、またはテンプレートを切り替えた場合、検索結果のセットが確定され、検索後の終了と見なされます。

検索後の処理は、以前の処理モジュールのクエリクリーニングおよび検索前の処理に基づいて行われます。 したがって、これらのモジュールに設定されたカスタム変数は、検索後の処理ルールで使用できます。 同様に、プリサーチ処理は、プレゼンテーションテンプレートに関連付けられた名前付き検索のそれぞれに、CGIパラメーターのローカルコピーが存在するすべてのテンプレートをインスタンス化しました。 また、各検索を個別にカスタマイズできます。

[クエリクリーニング規則について](../c-about-rules-menu/c-about-query-cleaning-rules.md#concept_17F3CDDC3C8A4128AF092A82B777B86C)を参照してください。

[Pre-Search Rules](../c-about-rules-menu/c-about-pre-search-rules.md#concept_5BF84BB6FACB4645BA9CB7496A01CD1F)についてを参照してください。

## 検索後のルールの条件について{#section_C43EB77CC0AC43B8B9D38569264BF1B5}

条件はオプションです。 すべてのクエリに対してアクションを指定するように指定した場合、アクションは常に実行されます。 前のルールで設定した任意のCGIクエリパラメーター、cookie、検索結果、またはカスタム変数に基づいて条件を設定できます。 または、現在選択されているテンプレートが何であるかや、最後の検索であるかなどのシステム条件に基づいてテンプレートを作成できます。 検索またはCGIパラメーターの結果に条件を作成する場合は、テンプレートと検索名を指定します。

## 検索後のルールのアクションについて{#section_0E15FE683A894ECAAA386267EEC7F7C5}

一致する条件を持つ検索後ルール内のすべてのアクションが実行されます。 通常、アクションは、操作、操作を実行するデータ、および使用する値で構成されます。 最も簡単なアクションは、検索後ルールの条件に基づいて、使用するプレゼンテーションテンプレートを切り替えることです。 より高度なアクションを使用して、検索をやり直す検索のパラメータを変更できます。 テンプレートの検索パラメータに対して操作を実行する場合は、プレゼンテーションテンプレートと検索を指定します。

## 一般的な規則{#section_AEE923988CC748FF9DEF2233FBF333B5}

テンプレートの検索パラメータに対して操作を実行する場合、プレゼンテーションテンプレートと名前付き検索のそれぞれに*targetedと*primaryの2つの特別な値が存在します。 これらの値を使用して、現在のターゲットテンプレートのプライマリ検索に基づくルールを作成します。 これらの構成を使用すると、現在のターゲットテンプレートやプライマリ検索が呼び出される内容を気にする必要がない、一般的なルールを作成できます。 このパスが検索後処理の最初のパスである場合、対象となるテンプレートは、検索前処理でに設定されているテンプレートです。

## {#section_E5669A2F13C240F2968E31C75591CD6A}にリダイレクト

クエリクリーニング内の直接ヒットおよびリダイレクトを使用すると、入力された検索用語に基づいてURLにリダイレクトできます。 検索後ルール内でリダイレクトすると、このアイデアが拡張されます。ただし、リダイレクトを行うかどうかを決定する前に、検索が返した結果の数を確認できる点が異なります。 検索後ルールを使用すると、URLにリダイレクトできます。URLでは、カスタム変数やクエリパラメーターを置き換えることができます。 または、最初の結果内のフィールドにリダイレクトできます。 結果のフィールドにリダイレクトする場合、トランスポートテンプレートでフィールドを定義し、有効な明示的なURLを含める必要があります。それ以外の場合、リダイレクトはスキップされます。

検索後ルール内でリダイレクトのメカニズムを使用すると、検索が単一の結果を返すタイミングを検出できます。 そのような結果を返す代わりに、結果に関連付けられたWebページにリダイレクトすることができます。

検索後ルールでリダイレクトを使用する例については、以下のリダイレクトの例を参照してください。

## 最後のルール{#section_FC1E0050C9324278B171038E98F6C335}

オプション&#x200B;**[!UICONTROL Last Rule]**&#x200B;が設定されたルールの条件が満たされた場合、検索後処理モジュールは、一致ルールのアクションの後に追加のルールを実行しません。 この状況は、後のルールが一致する原因となるアクションを設定しているが、処理を停止したい場合に役立ちます。 そして、その後のルールが、次の検索ラウンドの後に一致する可能性を持つようにします。

## 例 {#section_DDB98383690941F9B44AD00FBA55BB56}

次の例では、2つのプレゼンテーションテンプレートがあるとします。 一方のテンプレートは多数の検索結果を表示するのに使用され、他方のテンプレートは、一方の結果を表示するのに使用され、他方のテンプレートは、メイン検索に関連するアクセサリを追加で検索するのに使用されます。 1つの結果が得られたかどうかを検出し、他のプレゼンテーションテンプレートに切り替える場合。 このタスクを達成するには、次のルールを使用できます。

```
On condition: 
  targeted template is default 
  targeted template primary results equal 1 
  not last search 
Perform the following actions: 
  Set targeted template to product_spotlight
```

MegaElectronicは大規模なエレクトロニクス・ストアです。 MegaElectronicは、検索データを分析した後、多くの顧客が製品の部品番号を使用して製品検索を実行していることに気づきます。 このような場合、MegaElectronicは、顧客が製品を直接検索し、単一の製品しか見つからなかった場合、その製品に関連付けられているWebページにリダイレクトしたいと考えています。

この結果を得るには、3つの条件を持つ1つのルールを使用します。 最初の条件は、返された検索結果が1つだけであるかどうかをチェックします。 2つ目の条件では、クエリ用語がMegaElectronicの部品番号形式と一致し、リダイレクトの原因となる結果が示されます。 3つ目の条件では、部品番号が部品番号の一部で、複数の結果が返される場合があるので、顧客が1つの結果にドリルダウンするためにファセットを使用しないようにします。 アクションは結果内のフィールドにリダイレクトされます。

```
On condition: 
  targeted template's primary results equal 1 
  query q matches regular expression ^\D\D\D-\d+ 
  no facet selected ^\D\D\D-\d+ 
Perform the following actions: 
  redirect to result field "loc" in template *targeted for search *primary
```

## ベストプラクティス {#section_1BF7DE1BD5664B3BAEC26AA829FDB0BA}

* 新しい検索範囲をトリガーする一連のルールには、常に条件節が必要です。この句がモジュールの最後のパスではないかどうかをチェックします。 検索回数の上限を既に実行済みの場合は、検索をやり直すことはできません。
* モジュールを最後に通過した時点で結果がまだ不十分な場合は、「結果なし」テンプレートに切り替えることができます。
* プレゼンテーションテンプレートは、他のパラメーターを持つ可能性のある検索の結果に基づいて変更する必要があります。 入力クエリのみに基づくテンプレートを選択する場合は、検索前のルールの方が効率的です。
* クエリのデータマイニングは、クエリクリーニングモジュールで行います。 カスタム変数は、検索後の処理で参照できます。
* リダイレクトする場合は、常に、顧客がファセットを選択していないことを確認します。 その理由は、顧客がファセットをドリルダウンして、突然検索結果から離れた場合に不便であるためです。 顧客は、単一の結果を求めていないと見なされた場合に、ファセットの選択を解除することができます。

## 新しい検索後ルールの追加{#task_52F6F9AAD65B45B5ACA1FF245DFFADD9}

[!DNL Post-Search Rules]を使用して、入力クエリに基づいて検索結果を表示する際に使用するプレゼンテーションテンプレートを選択できます。

**新しい検索後ルールを追加するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Post-Search Rules]**&#x200B;をクリックします。
1. [!DNL Post-Search Rules]ページで、**[!UICONTROL Add New Rule]**&#x200B;をクリックします。
1. [!DNL Name]フィールドに、新しいクエリクリーニング規則の名前を入力します。
1. [!DNL Add Post-Search Rule]ページで、ドロップダウンリストとテキストフィールドを使用してクエリを作成します。

   <table> 
    <thead> 
      <tr> 
      <th colname="col1" class="entry"> <p>オプション </p> </th> 
      <th colname="col2" class="entry"> <p>説明 </p> </th> 
      </tr> 
    </thead>
    <tbody> 
      <tr> 
      <td colname="col1"> <p>Cookie </p> </td> 
      <td colname="col2"> <p>HTTP cookie。 Cookieの名前と値は、Uniform Resource Identifierをエンコードする必要があります。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>カスタム変数 </p> </td> 
      <td colname="col2"> <p>ユーザー定義の変数。 カスタム変数は無制限に追加、削除、設定できます。 </p> <p>検索後ルール内で、「クエリクリーニング」および「検索前ルール」モジュールで定義したカスタム変数を参照できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>システム変数 </p> </td> 
      <td colname="col2"> <p>チェックできる内部システムによって設定された読み取り専用の変数。 次のシステム変数がサポートされています。 </p> <p> 
        <ul id="ul_BC17F1637F27424CA4E8F530C28A3245"> 
          <li id="li_C7DF96EFD7AA4A449D00F7EACCAA0EB1"> <span class="uicontrol"> hostname </span> <p>サーバーホストの名前。 </p> </li> 
          <li id="li_F85AB1D2B9374A859657D12B8ED6674B"> <span class="uicontrol"> uri </span> <p>クエリ文字列を含まない、要求されたUniform Resource Identifier。 </p> </li> 
          <li id="li_440149C9EC6E4805B77BBC97BE41542A"> <span class="uicontrol"> args  </span> <p>クエリ文字列全体。 </p> </li> 
          <li id="li_F583FC4B0E404858BB3522B33A6F7A0A"> <span class="uicontrol"> 環境 </span> <p>"ステージ"または"ライブ"は、着信クエリがステージングされた環境ーに送信されたか、ライブ環境ーに送信されたかに応じて異なります。 </p> </li> 
          <li id="li_15902AA49B144D42A5E95D7E8B0FB1E1"> <span class="uicontrol"> referrer </span> <p>顧客の送信元のUniform Resource Locator。 </p> </li> 
        </ul> </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>システム変数 </p> </td> 
      <td colname="col2"> <p>読み取り専用の変数。現在の状態を判断する際に、条件で使用できます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートの検索ファセット </p> </td> 
      <td colname="col2"> <p>プレゼンテーションテンプレートに関連付けられた名前付き検索に対してローカルなファセット。 ファセットは、基本的に、顧客が選択したファセット内の値を示すために使用される特殊なCGIパラメーターです。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートの検索パラメーター </p> </td> 
      <td colname="col2"> <p>プレゼンテーションテンプレートに関連付けられた名前付き検索に対してローカルなCGIパラメーター。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>テンプレートのバックエンドパラメーター </p> </td> 
      <td colname="col2"> <p>着信クエリのパラメーターは、最終的に、検索の実行に使用されるバックエンドパラメーターに変換されます。 </p> <p><a href="../c-appendices/c-cgiparameters.md#reference_582E85C3886740C98FE88CA9DF7918E8" type="reference" format="dita" scope="local">バックエンド検索CGIパラメーター</a>を参照してください。 </p> <p>バックエンドパラメーターは、ナビゲーション要素に表示されません。 その結果、顧客から検索に適用する追加のパラメーターを非表示にできます。 </p> <p>このパラメータは、プレゼンテーションテンプレート内の特定の検索に対してローカルです。 バックエンドパラメーターに対するアクションは遅延バインディングです。つまり、検索が送信される直前に適用されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ターゲットテンプレート </p> </td> 
      <td colname="col2"> <p>削除できないシステム定義のカスタム変数の特殊なインスタンス。 この変数には、現在のターゲットプレゼンテーションテンプレートが含まれます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>ランク </p> </td> 
      <td colname="col2"> <p>検索に使用するランキングルールを指定できます。 このオプションは、ランキングフィールドとランキングルールを定義した場合にのみ表示されます。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>最後のルール </p> </td> 
      <td colname="col2"> <p>オンの場合、検索後処理モジュールは、一致ルールのアクションの後に追加のルールを実行しません。 このアクションは、後のルールが一致するように設定したが、後のルールを実行したくないアクションがある場合に便利です。 </p> </td> 
      </tr> 
      <tr> 
      <td colname="col1"> <p>停止 </p> </td> 
      <td colname="col2"> <p>ルールの実行をオフにしますが、ルールは削除されません。 </p> </td> 
      </tr> 
    </tbody> 
    </table>

1. クリック **[!UICONTROL Add]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索後のルールの編集{#task_ECB00334C0A74C87AF857DB3EB372119}

[!DNL Post-Search Rules]ページに追加した既存の検索後ルールを編集できます。

**検索後のルールを編集するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Pre-Search Rules]**&#x200B;をクリックします。
1. [!DNL Post-Search Rules]ページのテーブルの&#x200B;**[!UICONTROL Actions]**&#x200B;列の下で、編集する関連ルールの&#x200B;**[!UICONTROL Edit]**&#x200B;をクリックします。
1. [!DNL Edit Post-Search Rule]ページで、ドロップダウンリストとテキストフィールドを使用してクエリを作成します。

   「[新しい検索後ルールの追加](../c-about-rules-menu/c-about-post-search-rules.md#task_52F6F9AAD65B45B5ACA1FF245DFFADD9)」のオプションの表を参照してください。
1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索後のルールの削除{#task_0F4653AB20D54B769A4FA8D1491AB4CF}

不要になった、または使用しなくなった検索後ルールは削除できます。

ルールを削除すると、残りのルールが実行される順序が、削除を考慮して自動的に調整されます。

**検索後のルールを削除するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Post-Search Rules]**&#x200B;をクリックします。
1. [!DNL Post-Search Rules]ページのテーブルの&#x200B;**[!UICONTROL Actions]**&#x200B;列の下で、削除する関連ルールの&#x200B;**[!UICONTROL Delete]**&#x200B;をクリックします。
1. [!DNL Confirmation]ダイアログボックスで、**[!UICONTROL OK]**&#x200B;をクリックします。
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。

## 検索後のルールで{#task_40542FCD32234BBF881A81BF5477F78F}が実行される順序の変更

検索後のルールの順序を変更して、プレゼンテーションテンプレートで実行する順序を変更できます。

検索後のルールは、定義された順に実行されます。 ルールの順序番号が高いほど、プロセス内で後で実行され、以前のルールが切り捨てられます。 ルールの順序を変更するには、[!DNL Post-Search Rules]ページのテーブルの順序列に新しい番号を入力します。 ルールのドラッグ&amp;ドロップを使用して、ルールの実行順序を変更することもできます。

**検索後ルールの実行順序を変更するには**

1. 製品メニューで、**[!UICONTROL Rules]**/**[!UICONTROL Post-Search Rules]**&#x200B;をクリックします。
1. [!DNL Post-Search Rules]ページで、次のいずれかの操作を行います。

   * **[!UICONTROL Order]**&#x200B;列ヘッダーをクリックして、ルールを昇順または降順に並べ替えます。
   * [!DNL Order]列の検索前のルール名の左側にあるテキストフィールドに、ルールを実行する順序番号を入力します。
   * ルールを実行する位置にテーブル行をドラッグ&amp;ドロップします。 ルールが実行される新しい順序を反映するために、すべての注文番号が更新されます。

1. クリック **[!UICONTROL Save Changes]**.
1. （オプション）次のいずれかの操作を行います。

   * **[!UICONTROL History]**&#x200B;をクリックして、行った変更を元に戻します。

      [「履歴」オプションの使用](../t-using-the-history-option.md#task_70DD3F87A67242BBBD2CB27156F43002)を参照してください。

   * クリック **[!UICONTROL Live]**.

      [ライブ設定の表示](../c-about-staging.md#task_401A0EBDB5DB4D4CA933CBA7BECDC10F)を参照してください。

   * クリック **[!UICONTROL Push Live]**.

      [プッシュステージ設定をライブにする](../c-about-staging.md#task_44306783B4C0408AAA58B471DAF2D9A4)を参照してください。
