---
description: 近接検索を使用すると、Webサイト上の任意のページに一意の場所を関連付け、特定の場所からの距離（距離）で結果を検索および並べ替えることができます。
seo-description: 近接検索を使用すると、Webサイト上の任意のページに一意の場所を関連付け、特定の場所からの距離（距離）で結果を検索および並べ替えることができます。
seo-title: 近接検索について
solution: Target
title: 近接検索について
topic: Appendices,Site search and merchandising
uuid: 24fc9265-3400-46a7-b6e0-4de5b049a39a
translation-type: tm+mt
source-git-commit: ef818327e1cdaad79ac47575a8dfba1de3dc5c2e

---


# 近接検索について{#about-proximity-search}

近接検索を使用すると、Webサイト上の任意のページに一意の場所を関連付け、特定の場所からの距離（距離）で結果を検索および並べ替えることができます。

例えば、Webサイト上のページに、以下のような米国の郵便番号メタデータを入力したとします。

```
<meta name="zipcode" content="84057">
```

次に、郵便番号のメタデータのインデックスを作成するようにアカウントを設定します。 /// **[!UICONTROL Settings]** で、 **[!UICONTROL Metadata]** ペー **[!UICONTROL Definitions]** ジ **[!UICONTROL Add New Field]**&#x200B;上で [!DNL Add Field] 次のオプションを設定します。

* フィールド名: `zip`
* メタタグ名： `zipcode`
* データタイプ: **[!UICONTROL Location]**
* 並べ替え: **[!UICONTROL Ascending]**
* 既定の単位： **[!UICONTROL Miles]**

サイトのインデックス作成後、次の検索を実行します。

```
...&sp_q_location_1=84057&sp_x_1=zip&sp_q_max_1=100&sp_s=zip_proximity
```

結果セットには、郵便番号84057から100マイル以内にあるドキュメントが含まれ、この郵便番号からの距離の昇順で並べ替えられます。

米国の地域では、電話の市外局番を使用することもできます。 または、緯度と経度のペアを使用して、サイトのメタデータと検索条件で場所を指定できます。 場所のタイプは、提供されたデータの形式から自動的に決定されます。

3桁の場所の値（「DDD」。各「D」は0 ～ 9の10進数の数字を表します）は、米国の電話市外局番として扱われます。

5桁または5桁の4桁の場所の値（「DDDDDD」または「DDDDDD-DDDD」）は、米国の郵便郵便番号として扱われます。

「±DDD.DDDD±DDDDD.DDDDD」の正確な形式の位置の値は、緯度/経度のペアとして扱われます。 最初の符号付き数値は緯度を指定し、2番目の符号付き数値は経度を表します。

**重要**:正の緯度値、正の経度値、またはその両方を指定する場合、URLの「+」文字は、次のようにエンコードする必要があります `%2b`。 それ以外の場合、「+」はスペースとして解釈され、値は有効な場所として認識されません。 例えば、緯度の値が+49.2394で、経度の値が —123.1892だとします。URLの場所の部分（「+」エンコード）は、次のようになります。

```
...&sp_q_location_1=%2b49.2394-123.1892...
```

* 正の緯度値は、赤道の北の度を表します。
* 負の緯度値は赤道の南の度を表します。
* 正の経度値は、東経の度を表します。
* 負の経度値は、Prime Meridianの西経度を表します。

例えば、「+48.8577+002.2950」の値は、赤道から北へ48.8577度、プライムメリディアンから東へ2.295度を表します。これは、フランスのパリにあるエッフェル塔の正確な位置です。 数値記号と各桁は必須で、先頭と末尾のゼロも含まれます。 例えば、「48.8577+2.2950」、「+48.8577+2.2950」および「+48.8577+02.295」という3つの値は場所ではありません。 最初の値に緯度の先頭の記号がありません。 2番目の値には、経度の先頭の2つのゼロが欠けています。 3つ目の値の経度の末尾のゼロが欠けています。 インデックスログを調べて、場所に関する問題がないか注意深く調べてください。

近接検索を行う場合、その検索用に特別な「近接出力フィールド」が作成されます。 このフィールドには、検索条件で指定された場所と、各検索結果に関連付けられた場所との相対距離が入力されます。 この特殊なフィールドは、検索条件で使用される場所タイプフィールドの名前で、末尾に「_proximity」が追加されています。

上の例の検索では、結果は「zip_proximity」の昇順で並べ替えられています。 つまり、指定した郵便番号(84057)と各結果の「zip」フィールドの場所との距離です。 また、この特別な「近接出力フィールド」を使用して、検索テンプレートタグを使用して、各検索結果の相対距離をキロメートルまたはマイル単位で表示するこ `<Search-Display-Field>` ともできます。

詳しくは、検 [索テンプレートタグを参照してくださ](../c-appendices/c-templates.md#reference_F7AA3FF602314E42842BBC740D2CA1A4)い。

sp_sオプションを指定しないで検索することもできます。 この場合、結果はスコアで並べ替えられます(sp_s=0（デフォルト）)。スコアは、sp_q_location[_#パラメーターで指定された近接検索場所からの各結果の相対距離に影響を受けます] 。 近接検索に適用される関連性の計算をオプションで制御するために、新しいcgiパラメータsp_q_max_relevant_distance[#] が追加されました。

次に、近接性関連の検索例を示します。

```
...&sp_q_location_1=84057&sp_x_1=zip&sp_q_max_1=100&sp_q_2=shirt&sp_x_2=title&sp_q_max_relevant_distance_2=50
```

結果セットには、郵便番号84057から100マイル以内にある任意のドキュメントと、タイトルフィールドに「shirt」という単語が含まれ、近接性関連スコアリングの影響を受けたスコアリングで並べ替えられます。 近接コンポーネントの完全な関連性スコアは、距離0を表します。 近接コンポーネントの最小関連度スコアは、50マイルを超える距離を表します。

近接検索の詳細については、、、、、、、および「CGIパラメ `sp_location`ータを検索」リファレンスト `sp_location_#`ピックで確 `sp_q_min`認し、、、、、、、、、、お `sp_q_min_#``sp_q_max``sp_q_max_#``sp_s` よびを参照してください。

CGIパラメータ [ーの検索を参照してくださ](../c-appendices/c-cgiparameters.md#reference_DA27A8B0728246DA94994885E1353890)い。

詳しくは、 [新しいメタタグフィールドの追加を参照してくださ](../c-about-settings-menu/c-about-metadata-menu.md#task_6DF188C0FC7F4831A4444CA9AFA615E5)い。
