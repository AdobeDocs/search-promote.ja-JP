---
description: 近接検索を使用すると、Webサイト上の任意のページに固有の場所を関連付け、特定の場所からの距離（近接性）で結果を検索および並べ替えることができます。
solution: Target
title: 近接検索について
topic: Appendices,Site search and merchandising
uuid: 24fc9265-3400-46a7-b6e0-4de5b049a39a
translation-type: tm+mt
source-git-commit: d015154efdccbb4c6a39a56907c0c337ec065c9f
workflow-type: tm+mt
source-wordcount: '754'
ht-degree: 0%

---


# 近接検索について{#about-proximity-search}

近接検索を使用すると、Webサイト上の任意のページに固有の場所を関連付け、特定の場所からの距離（近接性）で結果を検索および並べ替えることができます。

例えば、Webサイト上に以下のような米国の郵便番号メタデータを含むデータを埋め込んだ場合、

```
<meta name="zipcode" content="84057">
```

次に、郵便番号のメタデータのインデックスを作成するようにアカウントを設定します。 **[!UICONTROL Settings]** > **[!UICONTROL Metadata]** > **[!UICONTROL Definitions]** > **[!UICONTROL Add New Field]**&#x200B;の[!DNL Add Field]ページで、次のオプションを設定します。

* フィールド名: `zip`
* メタタグ名：`zipcode`
* データタイプ: **[!UICONTROL Location]**
* 並べ替え: **[!UICONTROL Ascending]**
* 既定の単位：**[!UICONTROL Miles]**

サイトのインデックス作成後、次の検索を実行します。

```
...&sp_q_location_1=84057&sp_x_1=zip&sp_q_max_1=100&sp_s=zip_proximity
```

結果セットには、郵便番号84057から100マイル以内に位置するドキュメントが含まれ、この郵便番号からの距離の昇順で並べ替えられます。

米国の地域では、電話の市外局番を使用することもできます。 または、緯度と経度の組み合わせを使用して、サイトのメタデータと検索条件で場所を指定できます。 場所のタイプは、提供されるデータの形式から自動的に決定されます。

3桁の場所の値（「DDD」。「D」はそれぞれ0 ～ 9の10進数の桁を表します）は、米国の電話市外局番として扱われます。

5または5ダッシュ（4桁）の位置の値（「DDDDDD」または「DDDDDD-DDDD」）は、米国の郵便番号として扱われます。

「±DD.DDDD±DDD.DDDDD」という形式の位置の値は、緯度/経度のペアとして扱われます。 最初の符号付き数値は緯度を指定し、2番目の符号付き数値は経度を表します。

**重要**:緯度の正の値、経度の正の値、またはその両方を指定する場合、URL内の「+」文字は、次の形式でエンコードする必要があり `%2b`ます。それ以外の場合は、「+」はスペースとして解釈され、値は有効な場所として認識されません。 例えば、緯度の値が+49.2394で経度の値が —123.1892だったとします。URLの場所の部分は「+」エンコードされ、次のようになります。

```
...&sp_q_location_1=%2b49.2394-123.1892...
```

* 正の緯度値は、赤道の北の度を表します。
* 負の緯度値は、赤道の南の度を表します。
* 正の経度値は、Prime Meridianの東経度を表します。
* 負の経度値は、Prime Meridianの西経度を表します。

例えば、「+48.8577+002.2950」の値は、赤道から北へ48.8577度、プライムメリディアンから東へ2.295度、フランスのパリにあるエッフェル塔の正確な位置を表します。 数値記号と各桁は必須で、先頭と末尾のゼロも含みます。 例えば、「48.8577+2.2950」、「+48.8577+2.2950」および「+48.8577+02.295」という3つの値は場所ではありません。 最初の値に緯度の先頭の記号がない。 2番目の値には、経度の前にある2つのゼロが欠けています。 3番目の値の経度の末尾のゼロがない。 インデックス・ログを調べて、場所に関する問題がないか注意深く確認してください。

近接性で検索する場合、その検索に対して特別な「近接性出力フィールド」が作成されます。 このフィールドには、検索条件で指定された場所と、各検索結果に関連付けられた場所との相対距離が入力されます。 この特殊なフィールドは、検索条件で使用される場所タイプフィールドの名前で、末尾に「_proximity」が追加されています。

上の例の検索では、結果が「zip_proximity」の昇順で並べ替えられています。 つまり、指定した郵便番号(84057)から結果の「郵便番号」フィールドの位置までの距離です。 また、この特別な「近接出力フィールド」を使用して、`<Search-Display-Field>`検索テンプレートタグを使用して、各検索結果の相対距離をキロメートルまたはマイルで表示することもできます。

[検索テンプレートタグ](../c-appendices/c-templates.md#reference_F7AA3FF602314E42842BBC740D2CA1A4)を参照してください。

sp_sオプションを使用しないで検索することもできます。 この場合、結果はスコアで並べ替えられます（sp_s=0、デフォルト）。スコアは、sp_q_location[_#]パラメーターで指定された近接検索場所からの各結果の相対距離の影響を受けます。 近接検索に適用される関連性の計算をオプションで制御するために、新しいcgiパラメータsp_q_max_relevant_distance[#]が追加されます。

近接性に関する検索の例を次に示します。

```
...&sp_q_location_1=84057&sp_x_1=zip&sp_q_max_1=100&sp_q_2=shirt&sp_x_2=title&sp_q_max_relevant_distance_2=50
```

結果セットには、郵便番号84057から100マイル以内にあるドキュメントが含まれ、タイトルフィールドに「shirt」という単語が含まれます。この単語は、近接性のスコアリングの影響を受けたスコアリングで並べ替えられます。 近接性コンポーネントの完全な関連性スコアは、0の距離を表します。 近接性コンポーネントの最小関連性スコアは、50マイルを超える距離を表します。

近接検索の詳細については、「CGIパラメーターの検索」リファレンストピックの「`sp_location`、`sp_location_#`、`sp_q_min`、`sp_q_min_#`、`sp_q_max`、`sp_q_max_#`、`sp_s`」を参照して確認してください。

[CGIパラメーターの検索](../c-appendices/c-cgiparameters.md#reference_DA27A8B0728246DA94994885E1353890)を参照してください。

「[新しいmetaタグフィールドの追加](../c-about-settings-menu/c-about-metadata-menu.md#task_6DF188C0FC7F4831A4444CA9AFA615E5)」を参照してください。
